# YToke-backend

This is the dedicated backend for the [YToke~](https://github.com/YuantongL/YToke) app.

## Introduction

This is basically a Maven Java app hosted on Google App Engine, you can clone this and run/debug on your local computer. This backend serves the YToke~ client MacOS app, providing API for search video, report video tag and video impressions. A noSQL database hosted on Google Cloud Firestore is used to save the video statistics.

Some sample request includes:

    GET  https://ytokebackend.appspot.com/videos?q=[VideoName]&page=3
    POST https://ytokebackend.appspot.com/video/stats/tag
    POST https://ytokebackend.appspot.com/video/stats/impression

When a client asks the backend for videos, it asks the Invidious API (will be closed on October 1st, we will have to switch to something else) for Youtube video search, and then query the database for video statistics, it then combine those results and return to the client.

## Run and debug locally

Since this is a Maven Java application, to run the application locally, use the [Maven App Engine
plugin](https://cloud.google.com/appengine/docs/java/tools/using-maven).

I personally use Eclipse SDE for local development, relative tutorials include:
[Creating an App Engine Standard Application](https://cloud.google.com/eclipse/docs/creating-new-webapp)
[Deploying App Engine Standard Applications from Eclipse](https://cloud.google.com/eclipse/docs/deploying)

You also have to use Google Cloud datastore emulator for a local database by running:

    gcloud beta emulators datastore start

A few environment variables needs to be set in the project settings to point to local database, this is an example of what I use

    DATASTORE_DATASET=ytokebackend
    DATASTORE_EMULATOR_HOST=localhost:8081
    DATASTORE_EMULATOR_HOST_PATH=localhost:8081/datastore
    DATASTORE_HOST=http://localhost:8081
    DATASTORE_PROJECT_ID=ytokebackend
    DATASTORE_USE_PROJECT_ID_AS_APP_ID=true
    GOOGLE_CLOUD_PROJECT=ytokebackend

You can view the app at [localhost:8080](http://localhost:8080).

You can also use IntelliJ or other IDEs you prefer, but make sure follow the setup steps of that particular IDE on Google Cloud docs. Eventually I think I will have to switch to other IDE because Eclipse's poor performance on Mac comparing to others.

## Deploying to App Engine

[I](https://github.com/YuantongL) will handle the deployment of this project to Google App Engine. Basically I follow standard [Google App Engine doc in JAVA](https://cloud.google.com/appengine/docs/standard/java).

To deploy the app to App Engine, run

    mvn clean appengine:deploy

After the deploy finishes, you can view your application at
`https://YOUR_PROJECT.appspot.com`, where `YOUR_PROJECT` is your Google Cloud
project ID. You can see the new version deployed on the [App Engine section of
the Google Cloud Console](https://console.cloud.google.com/appengine/versions).

## Contribute

I'm not backend expert, opinions and corrections are welcomed! Currently a "popular videos" feature is under development, feel free to contribute as you like!

## Donation

Donation will be used to pay for the costs generated by Google App Engine (for hosting the backend). Thank you for supporting this project!

[Donate](https://www.paypal.com/biz/fund?id=L3P7NAM2MZLDS)

## License

YToke-backend is a open source app. The software is under the terms of the
[GNU General Public License V3](https://www.gnu.org/licenses/gpl-3.0.en.html).

[![GNU GPLv3 Image](https://www.gnu.org/graphics/gplv3-127x51.png)](http://www.gnu.org/licenses/gpl-3.0.en.html)
